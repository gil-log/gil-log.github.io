---
title: "JWT(Json Web Token)"
last_modified_at: 2021-07-14T12:20
categories: 
  - ê°œë…
tags: 
  - 'JWT' 
  - 'jjwt'
toc: true
toc_label: 'ëª©ì°¨'
toc_icon: 'sort'
toc_sticky: true
---

# ğŸ™†â€â™‚ï¸ import ğŸ™‡â€â™‚ï¸

[JWT(JSON Web Token) ë€?[ yoonbumtae (BGSMM)]](http://yoonbumtae.com/?p=3535)

[JWTë€?[geunwoobaek.log]](https://velog.io/@geunwoobaek/JWT%EB%9E%80)


# JWT

**`JWT(JSON Web Token)`**ëŠ” **JSON ê°ì²´ë¥¼ ì‚¬ìš©**í•˜ì—¬ **ê°€ë³ê³  ìê°€ìˆ˜ìš©ì ì¸ (self-contained) ë°©ì‹**ìœ¼ë¡œ **ì •ë³´ë¥¼ ì•ˆì „ì„± ìˆê²Œ ì „ë‹¬í•´ì£¼ê¸° ìœ„í•œ í† í°**ì´ë‹¤.

**`JWT`ëŠ” RFC7519 í‘œì¤€**ìœ¼ë¡œ,

**JSON ê°ì²´ í˜•íƒœ**ë¡œ **ë‹¹ì‚¬ì ê°„ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì „ì†¡í•˜ê¸° ìœ„í•œ ì†Œí˜•ì˜ ìì²´ í¬í•¨ í˜•ì‹ìœ¼ë¡œ ì •ì˜**ëœë‹¤.
_**ë‹¹ì‚¬ìê°„ì— ì „ì†¡í•  Claim**ì„ ë‚˜íƒ€ë‚´ëŠ” **URLì— ì•ˆì „(url-safe)**í•œ **ì••ì¶• ìˆ˜ë‹¨**_


---

# JWT êµ¬ì¡°
**`JWT`ì˜ êµ¬ì¡°**ëŠ” **`Header`, `Payload`,  `Signature` ì„¸ ê°€ì§€ë¥¼ í¬í•¨í•˜ëŠ” êµ¬ì¡°ë¥¼ ì¤€ìˆ˜**í•´ì•¼í•œë‹¤.

```
[Base64Encoded(HEADER)].
[Base64Encoded(PAYLOAD)].
[Encoded(SIGNATURE)]

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJpZCI6ImdpbGxvZyIsIm5hbWUiOiJHaWxsb2ciLCJpYXQiOjE1MTYyMzkwMjJ9.
_OqpMXmKk6ajncTx5zCcC4ZxQwoVJZKep0Hh-Aw5YRM
 ```

---

## Header


**`Header`ëŠ” ì¼ë°˜ì ìœ¼ë¡œ Token Type(typ)**ê³¼,

**ì‚¬ìš©ì¤‘ì¸ ì„œëª… Algorithm(alg)**ì˜ **ë‘ ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±**ëœë‹¤.

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

---

## Payload

**`Payload`**ëŠ” **Tokenì— ë‹´ì„ ì •ë³´**ë¥¼ ë‚˜íƒ€ë‚´ë©° **`Claim`ë“¤ì„ í¬í•¨**í•œë‹¤.

**`Claim`ì€ `Payload` í•œ ë¶€ë¶„ ë“¤ì„ ì˜ë¯¸**í•˜ê³ ,

**`name`, `value` í•œ ìŒì˜ êµ¬ì¡°ë¡œ êµ¬ì„±**ëœë‹¤.

**`Claim`ì—ëŠ” `Reserved(ë“±ë¡ëœ)`, `Public(ê³µê°œ)`, `Private(ë¹„ê³µê°œ)` ì„¸ ê°€ì§€ ìœ í˜•**ì´ ìˆë‹¤.

### Reserved Claim

**`Reserved Claim`**ì€ **ìœ ìš©í•˜ê³  ìƒí˜¸ ìš´ìš© ê°€ëŠ¥í•œ ì œê³µì„ ìœ„í•´ ê¶Œì¥ë˜ëŠ” ë¯¸ë¦¬ ì •ì˜ëœ Claim ì§‘í•©**ì´ë‹¤. 

**ì˜ˆì‹œëŠ” ì•„ë˜ í‘œ**ì™€ ê°™ë‹¤.

|Claim|ì•½ì–´|ì˜ë¯¸|
|:--:|:--:|:--:|
|Issuer|iss|ë°œí–‰ì|
|Expiration|exp|ë§Œë£Œì‹œê°„
|Subject|sub|ì£¼ì œ|
|Audience|aud|ëŒ€ìƒì|

```json
{
    "iss": "gillog",
    "exp": "1485270000000",
    "aud": "user",
    "sub": "study"
}
```

### Public Claim

**`Public Claim`**ë“¤ì€ **ì¶©ëŒì´ ë°©ì§€ëœ (Collision-Resistant) ì´ë¦„**ì„ ê°€ì§€ê³  ìˆì–´ì•¼ í•œë‹¤. 

**ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ Claim ì´ë¦„ì„ URI í˜•ì‹ìœ¼ë¡œ** ì§“ëŠ”ë‹¤.


### Private Claim

**`Private Claim`**ì€ **Client-Server ê°„ì˜ ë¯¸ë¦¬ ì •í•´ì ¸ ì‚¬ìš©ë˜ëŠ” Claim ì´ë¦„ë“¤**ì´ë‹¤. 

**`Public Claim`ê³¼ ë‹¬ë¦¬ ì´ë¦„ì´ ì¤‘ë³µë˜ì–´ ì¶©ëŒì´ ë  ìˆ˜ ìˆì–´ ìœ ì˜**í•´ì•¼ í•œë‹¤.

---

## Signature

**`Signature`ëŠ” JWTì˜ ë¬´ê²°ì„±ì„ ë³´ì¦í•˜ëŠ”ë° ì‚¬ìš©**í•˜ê³ , 

**`Private Key`ë¡œ ì„œëª…ëœ í† í°ì˜ ê²½ìš° JWT ë°œì‹ ìê°€ ëˆ„êµ¬ì¸ì§€ í™•ì¸í•  ìˆ˜ë„** ìˆë‹¤.

**`Signature`ë¥¼ ë§Œë“¤ê¸° ìœ„í•´**ì„  **Encodingëœ `Header`,** 

**Encodingëœ`Payload`ì™€ `Secret Key`, **

**`Header`ì—ì„œ ì§€ì •ëœ ì•”í˜¸í™” `Algoritm`**ì´ ìˆì–´ì•¼ í•œë‹¤.


---

# JWT ê³¼ì •

![](https://images.velog.io/images/gillog/post/69e280eb-0423-4767-916f-a1222cf887c6/image.png)

**1.`Browser`ëŠ” ë¡œê·¸ì¸ê³¼ì •ì—ì„œ íšŒì›ì •ë³´ë¥¼ `Server`ì— ì œê³µ.**

**2.`Server`ëŠ” íšŒì› ì •ë³´ì™€ `Secret Key`ë¥¼ ì´ìš©, `JWT`ë¥¼ ìƒì„±.**

**3.`Server`ëŠ” ìƒì„±í•œ `JWT`ë¥¼ `Browser`ì—ê²Œ ì „ì†¡.**

**4.`Browser`ëŠ” í•´ë‹¹ íšŒì›ì— ëŒ€í•œ ì •ë³´ê°€ í•„ìš”í• ë•Œ ë°œê¸‰ë°›ì€ `JWT`ë¥¼ Headerì— ë„£ì–´ `Server`ì—ê²Œ  ìš”ì²­.**

**5.`Server`ëŠ” `Secret Key`ë¡œ ìš”ì²­ JWTì˜ `Signature`ë¥¼ ê²€ì¦í•œ í›„ í•´ë‹¹ ì •ë³´ë¥¼ `Browser`ì—ê²Œ ì œê³µ.**

---

# JWT ì¥ì 

**JWTì˜ ì¥ì **ìœ¼ë¡œëŠ” **ìˆ˜ë§ì€ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œ ì§€ì›**ë˜ë©°, 

**ë‹¨ìˆœ JSON êµ¬ì¡°**ë¡œ **ê·¸ ìì²´ê°€ ëª¨ë“  ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ìê°€ìˆ˜ìš©ì (Self-Contained) íŠ¹ì„±**ì„ ì§€ë‹Œë‹¤.
_ë‹¤ë¥¸ í™˜ê²½ê³¼ **ì¢…ì†ë˜ì§€ ì•ŠëŠ” ë…ë¦½ì  êµ¬ì¡°**, **ë§Œë£Œ ê¸°ê°„ì´ ìì²´ ë‚´ì¥**_


**`Secret Key`ë¥¼ í†µí•´ Serverì¸¡ì—ì„œ ì‰½ê²Œ ë””ë²„ê¹… ë° ê´€ë¦¬**í•  ìˆ˜ ìˆê³ ,

**ìˆ˜í‰ ìŠ¤ì¼€ì¼ë§ì— ìš©ì´**í•˜ë‹¤.


ë˜í•œ **`HTTP Request`ì˜ `Header`** ë˜ëŠ” **`URLì˜ Parameter`ë¡œ ì‰½ê²Œ ì „ì†¡**ë  ìˆ˜ ìˆë‹¤.
_**REST Serviceë¡œ ì œê³µ ê°€ëŠ¥, íŠ¸ë˜í”½ ë¶€ë‹´ ì €í•˜**_

 
**ì‚¬ìš©ì ì¸ì¦ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ê°€ í† í° ìì²´ì— í¬í•¨**í•˜ê¸° ë•Œë¬¸ì—, 

**ë³„ë„ì˜ ì¸ì¦ ì €ì¥ì†Œê°€ í•„ìš”ì—†ë‹¤.**

ë”°ë¼ì„œ **`ë¶„ì‚° ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ í™˜ê²½`**ì—ì„œ,

**`ì¤‘ì•™ ì§‘ì¤‘ì‹ ì¸ì¦ ì„œë²„`ì™€ `ë°ì´í„°ë² ì´ìŠ¤`**ì— **ì˜ì¡´í•˜ì§€ ì•ŠëŠ”,**

**ì‰¬ìš´ ì¸ì¦ ë° ì¸ê°€ ë°©ë²•ì„ ì œê³µ**í•œë‹¤.



# JWT ë‹¨ì 

**`JWT`ëŠ” Client ì¸¡ì— ì €ì¥**ë˜ì–´ ìˆì–´, **Server DBì—ì„œ ì‚¬ìš©ì ì •ë³´ê°€ ë³€ê²½**ë˜ì—ˆë”ë¼ë„ **Tokenì— ì§ì ‘ ì ìš©í•  ìˆ˜ ì—†ë‹¤.**

**JWTëŠ” í¬ê¸°ê°€ ì‘ì§€ë§Œ ë§Œì•½ Payloadì˜ `Claim`ì´ ê³„ì† ì¶”ê°€**ë˜ë©´,
**`Token`ì´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆë‹¤.**

ì´ëŠ” **`Staless Application`ì—ì„œ `Token`ì´ í•­ìƒ `Request`ì™€ í•¨ê»˜ ì „ì†¡**ë˜ê¸°ë•Œë¬¸ì—,
**`ë°ì´í„° íŠ¸ë˜í”½` í¬ê¸°ì— ì˜í–¥ì„ ë¼ì¹  ìˆ˜ ìˆë‹¤.**



# JWT ì‚¬ìš© í•´ë³´ê¸°

**Javaì—ì„œ `jjwt`ë¼ëŠ” Libraryë¡œ ì‰½ê²Œ ì‚¬ìš©**í•´ë³¼ ìˆ˜ ìˆë‹¤.

## jjwt

**`jjwt`ëŠ” `JWT` ìƒì„± ë° íŒŒì‹±, ê²€ì¦ì„ ìœ„í•œ Library**ì´ë‹¤.

ì•„ë˜ **`Dependency`ë¥¼ Maven pom.xmlì— ì¶”ê°€í•˜ì—¬ Libararyë¥¼ ì„¤ì¹˜**í•´ë³´ì.

```
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt</artifactId>
            <version>0.9.1</version>
        </dependency>
```

ì•„ë˜ **ì˜ˆì œ Class ì²˜ëŸ¼ ê°„ë‹¨í•˜ê²Œ JWT Tokenì„ ìƒì„± ë° íŒŒì‹±, ê²€ì¦**í•  ìˆ˜ ìˆë‹¤.
_**jjwt 0.1x.0 ë²„ì „ëŒ€ ì´í›„ Deprecated ëœ Methodë“¤ì´ ë§ìœ¼ë‹ˆ ì°¸ê³ ë§Œ** í•˜ì_

```java
public class AuthJWT {
    private final String secretKey = "Gil11ogG2200";

    public static void main(String[] args) throws UnsupportedEncodingException {
        AuthJWT authJWT = new AuthJWT();

        String jwt = authJWT.createToken();
        
        Map<String, Object> claimMap = authJWT.verifyJWT(jwt);
        // í† í° ë§Œë£Œ or ê²€ì¦ ì‹¤íŒ¨ ì‹œ null
        System.out.println(claimMap); 
    }
        
    public String createToken() {

        //Header ì„¤ì •
        Map<String, Object> headers = new HashMap<>();
        headers.put("alg", "HS256");
        headers.put("typ", "JWT");

        //payload ì„¤ì •
        Map<String, Object> payloads = new HashMap<>();
        payloads.put("iss", "gillog");
        payloads.put("aud", "all");
        payloads.put("data", "Gillog JWT");

        Long expiredTime = 1000 * 60L * 60L * 2L; 

        Date expDate = new Date();
        expDate.setTime(expDate.getTime() + expiredTime);
     
        return Jwts.builder()
                .setHeader(headers) // Headers ì„¤ì •
                .setClaims(payloads) // Claims ì„¤ì •
                .setSubject("study") // í† í° ìš©ë„ 
                .setExpiration(expDate) // í† í° ë§Œë£Œ ì‹œê°„ ì„¤ì •
                .signWith(SignatureAlgorithm.HS256, secretKey.getBytes()) // HS256ê³¼ Keyë¡œ Sign
                .compact(); // í† í° ìƒì„±
    }
    
    public Map<String, Object> verifyJWT(String jwt) throws UnsupportedEncodingException {
        Map<String, Object> claimMap = null;
        try {
            Claims claims = Jwts.parserBuilder()
				.setSigningKey(secretKey.getBytes()) // Secreat Keyë¡œ Signature ì„¤ì •
				.build()
				.parseClaimsJws(jwt) // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ
				.getBody();

            claimMap = claims;

            // Claim ì‚¬ìš© ë²• ì¼ë°˜ Map í˜•íƒœ ì²˜ëŸ¼ ì‚¬ìš©
            Date expiration = claims.get("exp", Date.class);
            String data = claims.get("iss", String.class);
            
        } catch (ExpiredJwtException e) { // í† í° ë§Œë£Œ
            ...
        } catch (Exception e) { // ê·¸ ì™¸ ì—ëŸ¬
            ...
        }
        return claimMap;
    }    
}