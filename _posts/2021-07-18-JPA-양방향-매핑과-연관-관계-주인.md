---
title: "[JPA] ë‹¤ëŒ€ì¼ ê´€ê³„ ì–‘ë°©í–¥ ë§¤í•‘ ê³¼ ì—°ê´€ ê´€ê³„ ì£¼ì¸, ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ"
last_modified_at: 2021-07-18T11:12
categories: 
  - jpa
tags: 
  - 'JPA' 
  - 'ë‹¤ëŒ€ì¼ ê´€ê³„' 
  - 'ì–‘ë°©í–¥ ë§¤í•‘' 
  - 'ì—°ê´€ ê´€ê³„ ì£¼ì¸' 
  - 'ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ'
toc: true
toc_label: 'ëª©ì°¨'
toc_icon: 'sort'
toc_sticky: true
---

# ğŸ™†â€â™‚ï¸ import ğŸ™‡â€â™‚ï¸

[ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=62681446)


---

# ì–‘ë°©í–¥ ë§¤í•‘

**ì•„ë˜ì™€ ê°™ì€ ê´€ê³„ë¥¼ ê°€ì§€ëŠ” ë‘ TABLE**ì´ ìˆë‹¤ê³  í•˜ì.

![](https://images.velog.io/images/gillog/post/a1e6b5c7-6889-4d5d-80b9-375c5938693b/image.png)

**`USER`ì™€ `GROUP`ì€ ë‹¤ëŒ€ì¼ ê´€ê³„**ì´ê³ ,

**`GROUP`ì—ì„œ `USER`ëŠ” ì¼ëŒ€ë‹¤ ê´€ê³„**ì´ë‹¤.

ìœ„ ë‘ TABLEì„ `JPA`ì—ì„œ `Entity`ë¡œ Mappingí• ë•Œ

**ì¼ëŒ€ë‹¤ ê´€ê³„ì˜ ê²½ìš° ì—¬ëŸ¬ ê±´ê³¼ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, Collectionì„ ì‚¬ìš©**í•´ì•¼í•œë‹¤.
_JPAëŠ” List í¬í•¨ Collection, Set, Map ë“±ì„ ì§€ì›_

**ìœ„ ê´€ê³„ì—ì„œ `USER`, `GROUP` Entity ì˜ˆì‹œëŠ” ì•„ë˜**ì™€ ê°™ë‹¤.


```java
@Entity
public class User {
    
    @Id
    @Column(name = "U_ID")
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private long id;
    
    private String name;
    
    @ManyToOne
    @JoinColumn(name = "G_ID")
    private Group group;
    
    public void setGroup(Group group) {
    	if(this.group != null) {
            this.group.getUser().remove(this)
        }
        this.group = group;
        group.getUsers().add(this);
    }
}

@Entity
public class Group {

    @Id
    @Column(name = "G_ID")
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private long id;
    
    private String name;
    
    @OneToMany(mappedBy = "group")
    private List<User> users = new ArrayList<User>();
    
    public void addUser(User user) {
    	this.users.add(user);
        if (user.getGroup != this) {
            user.setGroup(this);
        }
    }
}
```

**`ë‹¤ëŒ€ì¼ ê´€ê³„`ì¸ `USER` ì¸¡ì—ëŠ” `@ManyToOne` Annotation**ì„,

**`ì¼ëŒ€ë‹¤ ê´€ê³„`ì¸ `GROUP`ì¸¡ì—ëŠ” `@OneToMany` Annotationì„ ì‚¬ìš©**í•´ì£¼ë©´ ë˜ëŠ”ë°,

ì´ë ‡ê²Œ **ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ë§ºê²Œë˜ë©´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •**í•´ì£¼ì–´ì•¼ í•œë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ **ì™¸ë˜í‚¤ê°€ ì €ì¥ë˜ëŠ” ë‹¤ ì¸¡ì„(USER) ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •**í•˜ëŠ”ë°,

**`@JoinColumn` Annotationìœ¼ë¡œ í•´ë‹¹ Tableì—ì„œ ì™¸ë˜í‚¤ì¸ `G_ID`ë¥¼ `name` ì†ì„±ìœ¼ë¡œ ì§€ì •**í•´ì£¼ë©´ ëœë‹¤.

```java
    @ManyToOne
    @JoinColumn(name = "G_ID")
    private Group group;
```

**í•œí¸ ì—°ê´€ê´€ê³„ ì£¼ì¸ì˜ ë°˜ëŒ€ Entity(GROUP) ì¸¡**ì—ëŠ” **`mappedBy`ë¥¼ ì§€ì •**í•´ì£¼ì–´ì•¼ í•œë‹¤.

**ì—°ê´€ê´€ê³„ ì£¼ì¸ì—ì„œ ì„¤ì •í•œ Field ëª…**ì¸ **`group`ì„ `mappedBy`ë¡œ ì„¤ì •**í•œë‹¤.

```java
    @OneToMany(mappedBy = "group")
    private List<User> users = new ArrayList<User>();
```
_**`@ManyToOne`ì€ mappedBy ì†ì„±ì„ ì„¤ì •í•  ìˆ˜ë„ ì—†ìŒ**, **í•­ìƒ ì™¸ë˜í‚¤ê°€ ì €ì¥ë˜ì–´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ë˜ê¸° ë•Œë¬¸**_

## ì–‘ë°©í–¥ ë§¤í•‘ ì •ë¦¬

**ë‹¨ìˆœí•˜ê²Œ ì •ë¦¬**í•˜ë©´ **ì–‘ë°©í–¥ ë§¤í•‘ì—ì„œ ì•„ë˜ë¥¼ ìƒê°í•˜ë©´ì„œ ë§¤í•‘**í•˜ë©´ëœë‹¤.

- **ë‘ ê°ì²´ ì—°ê´€ê´€ê³„ ì¤‘ í…Œì´ë¸” ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ìª½ì„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**ì´ë¼ í•¨.<br>_ë³´í†µ **ì™¸ë˜í‚¤ê°€ ì €ì¥ë˜ëŠ” í…Œì´ë¸”ì„ ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ì„¤ì •**_

- **ì—°ê´€ê´€ê³„ ì£¼ì¸ë§Œì´ DB ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘**ë˜ê³ , **ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •, ì‚­ì œ)í•  ìˆ˜ ìˆìŒ.**

- **ì—°ê´€ê´€ê³„ ì£¼ì¸ì€ `mappedBy` ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ.**

- **ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ì•„ë‹ˆë©´ `mappedBy` ì†ì„±ìœ¼ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •**í•´ì£¼ì–´ì•¼ í•¨.

- **`@ManyToOne`ì€ í•­ìƒ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë˜ê³ , `mappedBy` ì†ì„±ì„ ì„¤ì • ì¡°ì°¨ í•  ìˆ˜ ì—†ìŒ.**
_**DB ë‹¤ëŒ€ì¼ ê´€ê³„ì—ì„œ ë‹¤ì¸¡ì— ì™¸ë˜í‚¤ê°€ ì €ì¥ë˜ê¸° ë•Œë¬¸**_



# ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ

**ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ì–‘ ìª½ ê°ì²´ë¥¼ ëª¨ë‘ ì‹ ê²½ì¨ì•¼** í•˜ëŠ”ë°,

**í•˜ë‚˜ì˜ ë©”ì†Œë“œì—ì„œ ì–‘ì¸¡ì— ê´€ê³„ë¥¼ ì„¤ì •í•˜ê²Œ í•´ì£¼ëŠ” ê²ƒì´ ì•ˆì „**í•˜ë‹¤.

ì´ë ‡ê²Œ **í•œë²ˆì— ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë©”ì†Œë“œë¥¼ `ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ`** ë¼ ë¶€ë¥¸ë‹¤.

ì•„ê¹Œì „ **`User`ì™€ `Group` `Entity`ì—ì„œ ì•„ë˜ ë©”ì†Œë“œ**ê°€ **ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ**ì´ë‹¤.

```java
public class User {

    ...
    
    public void setGroup(Group group) {
    	if(this.group != null) {
            this.group.getUser().remove(this)
        }
        this.group = group;
        group.getUsers().add(this);
    }
}


@Entity
public class Group {

    ...
    
    public void addUser(User user) {
    	this.users.add(user);
        if (user.getGroup != this) {
            user.setGroup(this);
        }
    }
}
```

## `ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ`ë¥¼ ì‘ì„±í•  ë•Œ ì£¼ì˜ì‚¬í•­

1. **ë‹¤ëŒ€ì¼ì¸¡(User)ì—ì„œ ì—°ê´€ê´€ê³„ë¥¼ ì§€ì •í•  ë•Œ ê¸°ì¡´ ì—°ê´€ê´€ê³„ëŠ” ëŠì–´ì£¼ì–´ì•¼ í•œë‹¤.**

```java
public class User {

    ...
    
    public void setGroup(Group group) {
        // ì´ ë¶€ë¶„ì—ì„œ ê¸°ì¡´ì— Groupê³¼ ì—°ê´€ê´€ê³„ê°€ ìˆë‹¤ë©´
        // Groupì—ì„œ í•´ë‹¹ Userë¥¼ ë¨¼ì € ì œê±°í•œë‹¤.
    	if(this.group != null) {
            this.group.getUser().remove(this)
        }
        
        
        this.group = group;
        group.getUsers().add(this);
    }
}
```

<br>

2. **ì—°ê´€ê´€ê³„ë¥¼ ì €ì¥í•  ë•Œ ë¬´í•œ ë£¨í”„ë¥¼ ì£¼ì˜**í•´ì•¼ í•œë‹¤.


```java
public class User {

    ...
    
    public void setGroup(Group group) {
    	if(this.group != null) {
            this.group.getUser().remove(this)
        }
        this.group = group;
        // ì´ë¶€ë¶„ì´ ì—†ìœ¼ë©´ ë¬´í•œ ë£¨í”„ì— ê±¸ë¦°ë‹¤.
        if(!group.getUsers().contains(this)) {
            group.addUser(this);
        }
    }
}


@Entity
public class Group {

    ...
    
    public void addUser(User user) {
    	this.users.add(user);
        // ì´ë¶€ë¶„ì´ ì—†ìœ¼ë©´ ë¬´í•œ ë£¨í”„ì— ê±¸ë¦°ë‹¤.
        if (user.getGroup != this) {
            user.setGroup(this);
        }
    }
}
```

ë§Œì•½ `addUser`ì™€ `setGroup`methodì—ì„œ `if` ë¶€ë¶„ ë¡œì§ì„ ì œê±° í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```java
public class User {

    ...
    
    public void setGroup(Group group) {
    	if(this.group != null) {
            this.group.getUser().remove(this)
        }
        this.group = group;
        group.addUser(this);
    }
}


@Entity
public class Group {

    ...
    
    public void addUser(User user) {
    	this.users.add(user);
        
        user.setGroup(this);
    }
}
```

**ë§Œì•½ ì•„ë˜ë¥¼ í˜¸ì¶œí•´ë³´ë©´ ì•„ë˜ ê³¼ì •ìœ¼ë¡œ ë¬´í•œë£¨í”„ì— ë¹ ì§„ë‹¤.**

```java
User user = new User();
Group group = new Group();
user.setGroup(group);
```

1. setGroupì˜ `if(this.group != null)`ì€ ë¹ ì ¸ë‚˜ê°„ë‹¤.
2. userì˜ groupì€ `this.group = group`ìœ¼ë¡œ group ê°ì²´ì˜ ì£¼ì†Œê°’ì„ ì°¸ì¡°í•œë‹¤.
3. groupì˜ `addUser(user)`ë¥¼ í˜¸ì¶œí•œë‹¤.
4. groupì˜ `List<User> users`ì— userë¥¼ addí•œë‹¤.
5. userì˜ `setUser(group)`ì„ í˜¸ì¶œí•œë‹¤.
6. setGroupì˜ `if(this.group != null)`ì€ groupì„ ì°¸ì¡°í•˜ë¯€ë¡œ groupì—ì„œ userë¥¼ ì œê±°í•œë‹¤.
7. userì˜ groupì€ `this.group = group`ìœ¼ë¡œ group ê°ì²´ì˜ ì£¼ì†Œê°’ì„ ì°¸ì¡°í•œë‹¤.
8. groupì˜ `addUser(user)`ë¥¼ í˜¸ì¶œí•œë‹¤.
....

ë”°ë¼ì„œ setGroupì˜ `if(!group.getUsers().contains(this))`,

addUserì˜ `if (user.getGroup != this)` ë¡œì§ê³¼ ê°™ì´

**ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ì•Šê²Œ ì²´í¬í•´ì£¼ëŠ” ë¡œì§ì„ ë°˜ë“œì‹œ ì¶”ê°€**í•´ì•¼ í•œë‹¤.

<br>

3. **toString()ì—ì„œë„ ë¬´í•œ ë£¨í”„**ì— ê±¸ë¦´ ìˆ˜ ìˆë‹¤.

**`lombok`ì„ ì‚¬ìš©í•˜ë‹¤ ê°€ë³ê²Œ `@ToString`ì„ ì ì—ˆë‹¤ê°€ ë‚­íŒ¨**ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.

ë§Œì•½ **`User`ì—ë„ toStringì´ ìˆê³ , `Group`ì—ë„ toStringì´ ìˆë‹¤ë©´ ë§ˆì°¬ê°€ì§€ë¡œ ë¬´í•œ ë£¨í”„ì— ê±¸ë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜**í•´ì•¼í•œë‹¤.

```java
User user = new User();
Group group = new Group();
user.setGroup(group);

user.toString();

/////// toString ì˜ˆì‹œ
#####user#####
id=1
userId=gillog
group=
	#####group####
    	id=1
        name=java
        users={####user####
        	....
```